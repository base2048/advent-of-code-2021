## [AoC 2021 Day 24: Arithmetic Logic Unit](https://adventofcode.com/2021/day/24)

10 to the power of 14, not really computable the brute-force way. So it's a matter of analyzing the process data and finding another way to get to the goal. Doing this, the first thing you see is that the MONAD op-code consists of 14 similar blocks, each consisting of 18 separate instructions.

These blocks only differ in 3 operations, namely those in line number 5, 6 and 16 per block:

|      | *1&nbsp;(inc&nbsp;z)&nbsp;&nbsp;* | *2&nbsp;(inc&nbsp;z)&nbsp;&nbsp;* | *3&nbsp;(inc&nbsp;z)&nbsp;&nbsp;* | *4&nbsp;(inc&nbsp;z)&nbsp;&nbsp;* | *5&nbsp;(dec&nbsp;z)&nbsp;&nbsp;* | *6&nbsp;(dec&nbsp;z)&nbsp;&nbsp;* | *7&nbsp;(inc&nbsp;z)&nbsp;&nbsp;* | *8&nbsp;(dec&nbsp;z)&nbsp;&nbsp;* | *9&nbsp;(dec&nbsp;z)&nbsp;&nbsp;* | *10&nbsp;(dec&nbsp;z)&nbsp;&nbsp;* | *11&nbsp;(inc&nbsp;z)&nbsp;&nbsp;* | *12&nbsp;(dec&nbsp;z)&nbsp;&nbsp;* | *13&nbsp;(inc&nbsp;z)&nbsp;&nbsp;* | *14&nbsp;(dec&nbsp;z)&nbsp;&nbsp;* |
|------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|------------------------------------|------------------------------------|------------------------------------|------------------------------------|------------------------------------|
| *1*  | inp w                             | inp w                             | inp w                             | inp w                             | inp w                             | inp w                             | inp w                             | inp w                             | inp w                             | inp w                              | inp w                              | inp w                              | inp w                              | inp w                              |
| *2*  | mul x 0                           | mul x 0                           | mul x 0                           | mul x 0                           | mul x 0                           | mul x 0                           | mul x 0                           | mul x 0                           | mul x 0                           | mul x 0                            | mul x 0                            | mul x 0                            | mul x 0                            | mul x 0                            |
| *3*  | add x z                           | add x z                           | add x z                           | add x z                           | add x z                           | add x z                           | add x z                           | add x z                           | add x z                           | add x z                            | add x z                            | add x z                            | add x z                            | add x z                            |
| *4*  | mod x 26                          | mod x 26                          | mod x 26                          | mod x 26                          | mod x 26                          | mod x 26                          | mod x 26                          | mod x 26                          | mod x 26                          | mod x 26                           | mod x 26                           | mod x 26                           | mod x 26                           | mod x 26                           |
| *5*  | ***div z 1***                     | ***div z 1***                     | ***div z 1***                     | ***div z 1***                     | ***div z 26***                    | ***div z 26***                    | ***div z 1***                     | ***div z 26***                    | ***div z 26***                    | ***div z 26***                     | ***div z 1***                      | ***div z 26***                     | ***div z 1***                      | ***div z 26***                     |
| *6*  | ***add x 11***                    | ***add x 13***                    | ***add x 11***                    | ***add x 10***                    | ***add x -3***                    | ***add x -4***                    | ***add x 12***                    | ***add x -8***                    | ***add x -3***                    | ***add x -12***                    | ***add x 14***                     | ***add x -6***                     | ***add x 11***                     | ***add x -12***                    |
| *7*  | eql x w                           | eql x w                           | eql x w                           | eql x w                           | eql x w                           | eql x w                           | eql x w                           | eql x w                           | eql x w                           | eql x w                            | eql x w                            | eql x w                            | eql x w                            | eql x w                            |
| *8*  | eql x 0                           | eql x 0                           | eql x 0                           | eql x 0                           | eql x 0                           | eql x 0                           | eql x 0                           | eql x 0                           | eql x 0                           | eql x 0                            | eql x 0                            | eql x 0                            | eql x 0                            | eql x 0                            |
| *9*  | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                            | mul y 0                            | mul y 0                            | mul y 0                            | mul y 0                            |
| *10* | add y 25                          | add y 25                          | add y 25                          | add y 25                          | add y 25                          | add y 25                          | add y 25                          | add y 25                          | add y 25                          | add y 25                           | add y 25                           | add y 25                           | add y 25                           | add y 25                           |
| *11* | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                            | mul y x                            | mul y x                            | mul y x                            | mul y x                            |
| *12* | add y 1                           | add y 1                           | add y 1                           | add y 1                           | add y 1                           | add y 1                           | add y 1                           | add y 1                           | add y 1                           | add y 1                            | add y 1                            | add y 1                            | add y 1                            | add y 1                            |
| *13* | mul z y                           | mul z y                           | mul z y                           | mul z y                           | mul z y                           | mul z y                           | mul z y                           | mul z y                           | mul z y                           | mul z y                            | mul z y                            | mul z y                            | mul z y                            | mul z y                            |
| *14* | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                           | mul y 0                            | mul y 0                            | mul y 0                            | mul y 0                            | mul y 0                            |
| *15* | add y w                           | add y w                           | add y w                           | add y w                           | add y w                           | add y w                           | add y w                           | add y w                           | add y w                           | add y w                            | add y w                            | add y w                            | add y w                            | add y w                            |
| *16* | ***add y 14***                    | ***add y 8***                     | ***add y 4***                     | ***add y 10***                    | ***add y 14***                    | ***add y 10***                    | ***add y 4***                     | ***add y 14***                    | ***add y 1***                     | ***add y 6***                      | ***add y 0***                      | ***add y 9***                      | ***add y 13***                     | ***add y 12***                     |
| *17* | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                           | mul y x                            | mul y x                            | mul y x                            | mul y x                            | mul y x                            |
| *18* | add z y                           | add z y                           | add z y                           | add z y                           | add z y                           | add z y                           | add z y                           | add z y                           | add z y                           | add z y                            | add z y                            | add z y                            | add z y                            | add z y                            |

As we can see, the only persistent variable is *z*. *w*, *x* and *y* are repeatedly cleared and not carried over to the next block. A valid model number is given when the variable *z* has the value zero after MONAD has been processed.

Two different types of code blocks can be identified: those that increase the value of *z*, and those that decrease *z*. The blocks responsible for increasing do so by multiplying the current value of *z* by 26 and then adding the *y* input value. A decrease is done by dividing *z* by 26. The *y* input value has no further meaning here.

In both blocks the *x* input values serve to control the corresponding processes. In the case of the increase, *x* must be != w, so that *x* subsequently assumes the value 1. In the case of the decrease, this must be exactly the opposite. Here, the add-x operation sets the variable *x*, which holds the remainder of *w* mod 26, to the same value as *w*, i.e. x == w, which subsequently sets the value of *x* to zero. Additionally, in the decrease block, the *x* input corresponds directly to the *w* value.

Now, since we know that increase and decrease of *z* happen symmetrically, so to speak, once by multiplication by 26, once by division by 26, it would also be logical to find such a symmetry somehow in the number of blocks, since otherwise no further fancy mathematics can be found (remember, *z* must finally contain `0`). And so it is. There are 7 increasing blocks, and 7 decreasing blocks. In order to increase and decrease the variable *z* symmetrically, the value of the increase must be somewhat equal to the value of the decrease. In order to get a correct result in the end, we can mentally use a Stack. And indeed, for the implementation via code, we will eventually use a Stack as well.

Let's now delve a little deeper into the op-code and try to understand how we can create the required symmetry using the *w* input values. It doesn't seem necessary to keep track of the variable *z* itself. It is sufficient to store the *y* inputs of the increase operations. These values must operationally zero out during the corresponding decrease operation. And for this it is required to find the relevant interrelation.

The first corresponding block pair, namely block number 4 and block number 5, here for better demonstration filled with *w* values that achieve the largest possible model number, looks as follows:

| *4 (inc z)*    | z = 14,521  | z = 377,558 | *5 (dec z)*    |
|----------------|-------------|-------------|----------------|
| inp w          | w = 2       | w = 9       | inp w          |
| mul x 0        | x = 0       | x = 0       | mul x 0        |
| add x z        | x = 14,521  | x = 377,558 | add x z        |
| mod x 26       | x = 13      | x = 12      | mod x 26       |
| ***div z 1***  | z = 14,521  | z = 14,521  | ***div z 26*** |
| ***add x 10*** | x = 23      | x = 9       | ***add x -3*** |
| eql x w        | x = 0       | x = 1       | eql x w        |
| eql x 0        | x = 1       | x = 0       | eql x 0        |
| mul y 0        | y = 0       | y = 0       | mul y 0        |
| add y 25       | y = 25      | y = 25      | add y 25       |
| mul y x        | y = 25      | y = 0       | mul y x        |
| add y 1        | y = 26      | y = 1       | add y 1        |
| mul z y        | z = 377,546 | z = 14,521  | mul z y        |
| mul y 0        | y = 0       | y = 0       | mul y 0        |
| add y w        | y = 2       | y = 9       | add y w        |
| ***add y 10*** | y = 12      | y = 23      | ***add y 14*** |
| mul y x        | y = 12      | y = 0       | mul y x        |
| add z y        | z = 377,558 | z = 14,521  | add z y        |

We see that in the decrease operation the *y* input does not matter. So we can take this value out of the equation. Furthermore, we see that we get the identification of the block itself indicated by the *x* input. In all decrease blocks, *x* input is less than zero.

After several pages of scribbled paper, a fair amount of coffee and a lot of thinking and trial and error, we can identify the following two variables as being relevant: on the left side of the equation, representing the increase block, `y_inc`, and on the right side of the equation, representing the decrease block, `x_dec`. These two variables in conjunction with their corresponding *w* input values must therefore lead to a zero-sum game: `y_inc + x_dec = 0`.

By enhancing this knowledge with *w* input values, we finally obtain the following equation: `w_inc + y_inc = w_dec - x_dec`.

And now we can start looking for *w* values in corresponding blocks, considering the specification that only digits from 1 to 9 area allowed. In part one, we are looking for the largest possible number, so at least one of the two corresponding digits will be 9. In part two, we are looking for the lowest possible number, so at least one of the digits will be 1. All what's left is to turn the whole thing into code, and we're done.

---

![AoC 2021 Day 24](../day24--Arithmetic_Logic_Unit.png?raw=true)
